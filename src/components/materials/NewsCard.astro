---
import type { News } from "../../types";

const { color, data, title } = Astro.props;
---

<section
  class="w-auto h-auto text-white flex flex-col gap-2 text-lg md:text-[15px]"
>
  <aside
    class="p-2 rounded-[10px] shadow-[-10px_15px_20px_0_var(--third-gray-color)] bg-[var(--sixty-gray-color)] w-[261px]"
  >
    {title}
  </aside>
  <section
    class="w-[640px] md:w-[480px] md:h-[600px] flex flex-col gap-2 shadow-[-10px_15px_20px_0_var(--third-gray-color)] bg-[var(--secondary-gray-color)] rounded-[5px_20px_20px_5px] py-4 px-5"
  >
    <div
      class="w-[620px] md:w-[440px] px-5 py-4 flex flex-col gap-2 overflow-y-auto"
    >
      {
        data.length === 0 ? (
          <p class="text-center text-gray-400 mt-10">
            No hay noticias disponibles por el momento.
          </p>
        ) : (
          data.map((item: any) => {
            const date = new Date(item.data.pubDate).toLocaleDateString(
              "es-ES",
              {
                year: "numeric",
                month: "short",
                day: "numeric",
              },
            );
            // HYBRID LOGIC: If externalUrl exists, use it. Otherwise, use internal slug.
            const url = item.data.externalUrl ?? `/news/${item.slug}`;
            const target = item.data.externalUrl ? "_blank" : "_self";
            const rel = item.data.externalUrl ? "noopener noreferrer" : "";

            return (
              <a
                href={url}
                target={target}
                rel={rel}
                class="group relative bg-[var(--sixty-gray-color)] rounded-[10px] h-[90px] pt-4 pb-4 px-4 hover:bg-zinc-800 hover:scale-[1.02] transition-all duration-300 ease-out border border-transparent hover:border-white/10"
              >
                <div
                  class={`absolute top-4 left-3 rounded-full w-3 h-3 ${color} shadow-[0_0_10px_rgba(255,255,255,0.3)]`}
                />
                <div class="ml-6 flex flex-col justify-between h-full">
                  <h3 class="font-medium text-zinc-100 line-clamp-2 leading-tight group-hover:text-emerald-400 transition-colors">
                    {item.data.title}
                    {item.data.externalUrl && (
                      <span class="inline-block ml-2 text-xs text-zinc-500 scale-90 align-middle">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-3 w-3"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                          />
                        </svg>
                      </span>
                    )}
                  </h3>
                  <div class="flex justify-between items-end mt-1">
                    <p class="text-xs text-gray-500 line-clamp-1 w-[200px]">
                      {item.data.description}
                    </p>
                    <span class="text-xs text-gray-400 font-mono bg-black/30 px-2 py-0.5 rounded">
                      {date}
                    </span>
                  </div>
                </div>
              </a>
            );
          })
        )
      }
    </div>
  </section>
</section>
